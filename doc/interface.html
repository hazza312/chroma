<html style="background: rgb(195, 226, 81)"><body style="padding: 25px; margin: 25px; background: #333; font-family: monospace"><span title="comment" style="color: #fff">#</span> <span title="comment" style="color: #fff">Compiler</span> <span title="comment" style="color: #fff">defined</span> <br><span title="comment" style="color: #fff">These</span> <span title="comment" style="color: #fff">words</span> <span title="comment" style="color: #fff">are</span> <span title="comment" style="color: #fff">pre-defined</span> <span title="comment" style="color: #fff">and</span> <span title="comment" style="color: #fff">available</span> <span title="comment" style="color: #fff">for</span> <span title="comment" style="color: #fff">use</span> <span title="comment" style="color: #fff">as</span> <span title="comment" style="color: #fff">directives/in</span> <span title="comment" style="color: #fff">macros</span> <br><br><span title="comment" style="color: #fff">Binary</span> <span title="comment" style="color: #fff">handling</span> <br><span title="macro definition" style="color: #00FFFF">sections</span> <span title="comment" style="color: #fff">(n</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">initialise</span> <span title="comment" style="color: #fff">n</span> <span title="comment" style="color: #fff">compiler</span> <span title="comment" style="color: #fff">sections</span> <br><span title="macro definition" style="color: #00FFFF">endian</span> <span title="comment" style="color: #fff">(big|little</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">set</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">endinanness</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">compiler</span> <br><span title="macro definition" style="color: #00FFFF">big</span> <span title="comment" style="color: #fff">(--</span> <span title="comment" style="color: #fff">big)</span> <br><span title="macro definition" style="color: #00FFFF">little</span> <span title="comment" style="color: #fff">(--</span> <span title="comment" style="color: #fff">little)</span> <br><span title="macro definition" style="color: #00FFFF">write</span> <span title="comment" style="color: #fff">(section#</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">write</span> <span title="comment" style="color: #fff">section#</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">output</span> <span title="comment" style="color: #fff">file</span> <br><span title="macro definition" style="color: #00FFFF">padding</span> <span title="comment" style="color: #fff">(n</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">write</span> <span title="comment" style="color: #fff">n</span> <span title="comment" style="color: #fff">bytes</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">padding</span> <span title="comment" style="color: #fff">directly</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">output</span> <span title="comment" style="color: #fff">binary</span> <br><span title="macro definition" style="color: #00FFFF">magic!</span> <span title="comment" style="color: #fff">(section#</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">set</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">section</span> <span title="comment" style="color: #fff">where</span> <span title="comment" style="color: #fff">magic</span> <span title="comment" style="color: #fff">(grey)</span> <span title="comment" style="color: #fff">numbers</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">written</span> <span title="word definition" style="color: #ff0000">#todo</span> <br><br><span title="comment" style="color: #fff">Section</span> <span title="comment" style="color: #fff">handling</span> <br><span title="macro definition" style="color: #00FFFF">w8/w16/w32</span> <span title="comment" style="color: #fff">(val</span> <span title="comment" style="color: #fff">section#</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">write</span> <span title="comment" style="color: #fff">val</span> <span title="comment" style="color: #fff">as</span> <span title="comment" style="color: #fff">n-bit</span> <span title="comment" style="color: #fff">word</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">section#</span> <br><span title="macro definition" style="color: #00FFFF">!</span> <span title="comment" style="color: #fff">(val</span> <span title="comment" style="color: #fff">section</span> <span title="comment" style="color: #fff">var</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">store</span> <span title="comment" style="color: #fff">val</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">section</span> <span title="comment" style="color: #fff">variable</span> <br><span title="macro definition" style="color: #00FFFF">@</span> <span title="comment" style="color: #fff">(section</span> <span title="comment" style="color: #fff">var</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">val)</span> <span title="comment" style="color: #fff">fetch</span> <span title="comment" style="color: #fff">val</span> <span title="comment" style="color: #fff">from</span> <span title="comment" style="color: #fff">section</span> <span title="comment" style="color: #fff">variable</span> <br><span title="macro definition" style="color: #00FFFF">i!</span> <span title="comment" style="color: #fff">(val</span> <span title="comment" style="color: #fff">ptr</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">write</span> <span title="comment" style="color: #fff">val</span> <span title="comment" style="color: #fff">as</span> <span title="comment" style="color: #fff">8-bit</span> <span title="comment" style="color: #fff">byte</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">position</span> <span title="comment" style="color: #fff">ptr</span> <span title="comment" style="color: #fff">in</span> <span title="comment" style="color: #fff">section</span> <span title="comment" style="color: #fff">01</span> <span title="word definition" style="color: #ff0000">#todo</span> <br><span title="macro definition" style="color: #00FFFF">cpy</span> <span title="comment" style="color: #fff">(str</span> <span title="comment" style="color: #fff">section#</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">copy</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">string,</span> <span title="comment" style="color: #fff">appending</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">end</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">section#</span> <br><br><span title="comment" style="color: #fff">Compiler</span> <span title="comment" style="color: #fff">stack</span> <br><span title="macro definition" style="color: #00FFFF">swap</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">a)</span> <span title="comment" style="color: #fff">swap</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">top</span> <span title="comment" style="color: #fff">two</span> <span title="comment" style="color: #fff">items</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">compiler</span> <span title="comment" style="color: #fff">stack</span> <br><span title="macro definition" style="color: #00FFFF">dup</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">a)</span> <span title="comment" style="color: #fff">duplicate</span> <span title="comment" style="color: #fff">TOS</span> <br><span title="macro definition" style="color: #00FFFF">drop</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">drop</span> <span title="comment" style="color: #fff">TOS</span> <br><br><span title="comment" style="color: #fff">Arithmetic</span> <br><span title="macro definition" style="color: #00FFFF">+</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">a+b)</span> <span title="comment" style="color: #fff">add</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">top</span> <span title="comment" style="color: #fff">two</span> <span title="comment" style="color: #fff">elements</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">stack</span> <br><span title="macro definition" style="color: #00FFFF">-</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">a-b)</span> <span title="comment" style="color: #fff">subtract</span> <span title="comment" style="color: #fff">TOS</span> <span title="comment" style="color: #fff">from</span> <span title="comment" style="color: #fff">previously</span> <span title="comment" style="color: #fff">pushed</span> <span title="comment" style="color: #fff">value</span> <br><br><span title="comment" style="color: #fff">Misc</span> <br><span title="macro definition" style="color: #00FFFF">len</span> <span title="comment" style="color: #fff">(str</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">n)</span> <span title="comment" style="color: #fff">push</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">length</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">string</span> <br><span title="macro definition" style="color: #00FFFF">.S</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">display</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">current</span> <span title="comment" style="color: #fff">state</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">stack</span> <br><br><br><br><span title="comment" style="color: #fff">#</span> <span title="comment" style="color: #fff">Language</span> <span title="comment" style="color: #fff">layer</span> <br><span title="comment" style="color: #fff">The</span> <span title="comment" style="color: #fff">compiler</span> <span title="comment" style="color: #fff">requires</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">platform</span> <span title="comment" style="color: #fff">implement</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">following</span> <span title="comment" style="color: #fff">macros:</span> <br><br><span title="macro definition" style="color: #00FFFF">compile</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">begins</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">process</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">assembling</span> <span title="comment" style="color: #fff">binary</span> <span title="comment" style="color: #fff">after</span> <span title="comment" style="color: #fff">all</span> <span title="comment" style="color: #fff">source</span> <span title="comment" style="color: #fff">has</span> <span title="comment" style="color: #fff">been</span> <span title="comment" style="color: #fff">read</span> <span title="comment" style="color: #fff">and</span> <span title="comment" style="color: #fff">compiled.</span> <span title="comment" style="color: #fff">The</span> <span title="comment" style="color: #fff">sections</span> <span title="comment" style="color: #fff">contain</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">data</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">written</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">final</span> <span title="comment" style="color: #fff">binary.</span> <span title="comment" style="color: #fff">A</span> <span title="comment" style="color: #fff">simple</span> <span title="comment" style="color: #fff">implementation</span> <span title="comment" style="color: #fff">that</span> <span title="comment" style="color: #fff">directly</span> <span title="comment" style="color: #fff">writes</span> <span title="comment" style="color: #fff">two</span> <span title="comment" style="color: #fff">sections</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">output:</span> <br><span title="comment" style="color: #fff">==></span> <span title="macro execution" style="color: #FFFF00">text</span> <span title="macro execution" style="color: #FFFF00">write</span> <span title="macro execution" style="color: #FFFF00">00</span> <span title="macro execution" style="color: #FFFF00">padding</span> <span title="macro execution" style="color: #FFFF00">data</span> <span title="macro execution" style="color: #FFFF00">write</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">lit</span> <span title="comment" style="color: #fff">(n</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">producing</span> <span title="comment" style="color: #fff">code</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">emitted</span> <span title="comment" style="color: #fff">such</span> <span title="comment" style="color: #fff">that</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">numeric</span> <span title="comment" style="color: #fff">literal</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">pushed</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">run-time</span> <span title="comment" style="color: #fff">stack.</span> <span title="comment" style="color: #fff">This</span> <span title="comment" style="color: #fff">will</span> <span title="comment" style="color: #fff">likely</span> <span title="comment" style="color: #fff">require</span> <span title="comment" style="color: #fff">some</span> <span title="comment" style="color: #fff">machine</span> <span title="comment" style="color: #fff">code.</span> <span title="comment" style="color: #fff">An</span> <span title="comment" style="color: #fff">example</span> <span title="comment" style="color: #fff">implementation</span> <span title="comment" style="color: #fff">could</span> <span title="comment" style="color: #fff">be</span> <br><span title="comment" style="color: #fff">==></span> <span title="comment" style="color: #fff">machine-dup</span> <span title="compiled call, word, literal" style="color: #00FF7F">dup</span> <span title="comment" style="color: #fff">load</span> <span title="comment" style="color: #fff">immediate</span> <span title="comment" style="color: #fff">opcode</span> <span title="machine code" style="color: #aaaaaa">b8</span> <span title="macro execution" style="color: #FFFF00">code</span> <span title="comment" style="color: #fff">section</span> <span title="macro execution" style="color: #FFFF00">m16</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">str</span> <span title="comment" style="color: #fff">(str</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">string</span> <span title="comment" style="color: #fff">literal</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">compiled</span> <span title="comment" style="color: #fff">into</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">binary,</span> <span title="comment" style="color: #fff">and</span> <span title="comment" style="color: #fff">code</span> <span title="comment" style="color: #fff">output</span> <span title="comment" style="color: #fff">such</span> <span title="comment" style="color: #fff">that</span> <span title="comment" style="color: #fff">at</span> <span title="comment" style="color: #fff">runtime,</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">reference</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">literal</span> <span title="comment" style="color: #fff">is</span> <span title="comment" style="color: #fff">placed</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">run-time</span> <span title="comment" style="color: #fff">stack.</span> <span title="comment" style="color: #fff">Example:</span> <span title="comment" style="color: #fff">an</span> <span title="comment" style="color: #fff">implementation</span> <span title="comment" style="color: #fff">that</span> <span title="comment" style="color: #fff">appends</span> <span title="comment" style="color: #fff">string</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">"data"</span> <span title="comment" style="color: #fff">section</span> <br><span title="comment" style="color: #fff">==></span> <span title="comment" style="color: #fff">emit</span> <span title="comment" style="color: #fff">code</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">push</span> <span title="comment" style="color: #fff">address</span> <span title="macro execution" style="color: #FFFF00">data</span> <span title="macro execution" style="color: #FFFF00">ptr</span> <span title="macro execution" style="color: #FFFF00">@</span> <span title="macro execution" style="color: #FFFF00">lit</span> <span title="comment" style="color: #fff">copy</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">section</span> <span title="macro execution" style="color: #FFFF00">data</span> <span title="macro execution" style="color: #FFFF00">cpy</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">jmp</span> <span title="comment" style="color: #fff">(addr</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">an</span> <span title="comment" style="color: #fff">absolute</span> <span title="comment" style="color: #fff">address</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">compiled</span> <span title="comment" style="color: #fff">into</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">jump.</span> <span title="comment" style="color: #fff">Depending</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">architecture</span> <span title="comment" style="color: #fff">or</span> <span title="comment" style="color: #fff">size</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">call,</span> <span title="comment" style="color: #fff">this</span> <span title="comment" style="color: #fff">could</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">compiled</span> <span title="comment" style="color: #fff">as</span> <span title="comment" style="color: #fff">an</span> <span title="comment" style="color: #fff">absolute</span> <span title="comment" style="color: #fff">or</span> <span title="comment" style="color: #fff">relative</span> <span title="comment" style="color: #fff">call,</span> <span title="comment" style="color: #fff">at</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">platform's</span> <span title="comment" style="color: #fff">discretion.</span> <span title="comment" style="color: #fff">An</span> <span title="comment" style="color: #fff">example</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">an</span> <span title="comment" style="color: #fff">16-bit</span> <span title="comment" style="color: #fff">relative</span> <span title="comment" style="color: #fff">jump</span> <span title="comment" style="color: #fff">implementation:</span> <br><span title="comment" style="color: #fff">==></span> <span title="comment" style="color: #fff">calculate</span> <span title="comment" style="color: #fff">relative</span> <span title="comment" style="color: #fff">offset</span> <span title="macro execution" style="color: #FFFF00">text</span> <span title="macro execution" style="color: #FFFF00">ptr</span> <span title="macro execution" style="color: #FFFF00">@</span> <span title="macro execution" style="color: #FFFF00">-</span> <span title="macro execution" style="color: #FFFF00">03</span> <span title="macro execution" style="color: #FFFF00">-</span> <span title="comment" style="color: #fff">opcode</span> <span title="machine code" style="color: #aaaaaa">e9</span> <span title="comment" style="color: #fff">offset</span> <span title="macro execution" style="color: #FFFF00">code</span> <span title="macro execution" style="color: #FFFF00">m16</span> <br><br><span title="macro definition" style="color: #00FFFF">call</span> <span title="comment" style="color: #fff">(addr</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">an</span> <span title="comment" style="color: #fff">absolute</span> <span title="comment" style="color: #fff">address</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">compiled</span> <span title="comment" style="color: #fff">into</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">call.</span> <span title="comment" style="color: #fff">Relative/absolute</span> <span title="comment" style="color: #fff">nature</span> <span title="comment" style="color: #fff">at</span> <span title="comment" style="color: #fff">platform's</span> <span title="comment" style="color: #fff">discretion.</span> <span title="comment" style="color: #fff">This</span> <span title="comment" style="color: #fff">must</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">call</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">later</span> <span title="comment" style="color: #fff">matched</span> <span title="comment" style="color: #fff">with</span> <span title="macro execution" style="color: #FFFF00">;</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">it</span> <span title="comment" style="color: #fff">is</span> <span title="comment" style="color: #fff">given</span> <span title="comment" style="color: #fff">this</span> <span title="comment" style="color: #fff">cannot</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">optimised</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">a</span> <span title="macro execution" style="color: #FFFF00">jmp</span> <span title="comment" style="color: #fff">(immediate</span> <span title="comment" style="color: #fff">token</span> <span title="comment" style="color: #fff">is</span> <span title="comment" style="color: #fff">not</span> <span title="comment" style="color: #fff">;).</span> <span title="comment" style="color: #fff">An</span> <span title="comment" style="color: #fff">example</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">an</span> <span title="comment" style="color: #fff">16-bit</span> <span title="comment" style="color: #fff">relative</span> <span title="comment" style="color: #fff">call</span> <span title="comment" style="color: #fff">implementation:</span> <br><span title="comment" style="color: #fff">==></span> <span title="comment" style="color: #fff">calculate</span> <span title="comment" style="color: #fff">relative</span> <span title="comment" style="color: #fff">offset</span> <span title="macro execution" style="color: #FFFF00">text</span> <span title="macro execution" style="color: #FFFF00">ptr</span> <span title="macro execution" style="color: #FFFF00">@</span> <span title="macro execution" style="color: #FFFF00">-</span> <span title="macro execution" style="color: #FFFF00">03</span> <span title="macro execution" style="color: #FFFF00">-</span> <span title="comment" style="color: #fff">opcode</span> <span title="machine code" style="color: #aaaaaa">e8</span> <span title="comment" style="color: #fff">offset</span> <span title="macro execution" style="color: #FFFF00">code</span> <span title="macro execution" style="color: #FFFF00">m16</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">vardef</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">ref)</span> <span title="comment" style="color: #fff">define</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">new</span> <span title="comment" style="color: #fff">variable</span> <span title="word definition" style="color: #ff0000">#todo</span> <br><span title="macro definition" style="color: #00FFFF">varref</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">ref</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">push</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">reference</span> <span title="comment" style="color: #fff">onto</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">machine</span> <span title="comment" style="color: #fff">stack.</span> <span title="word definition" style="color: #ff0000">#todo</span> <br><br><br><span title="comment" style="color: #fff">The</span> <span title="comment" style="color: #fff">following</span> <span title="comment" style="color: #fff">macros</span> <span title="comment" style="color: #fff">are</span> <span title="comment" style="color: #fff">not</span> <span title="comment" style="color: #fff">directly</span> <span title="comment" style="color: #fff">required</span> <span title="comment" style="color: #fff">by</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">compiler,</span> <span title="comment" style="color: #fff">but</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">written</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">implement</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">rest</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">language</span> <span title="comment" style="color: #fff">for</span> <span title="comment" style="color: #fff">usercode:</span> <br><br><span title="comment" style="color: #fff">Control</span> <span title="comment" style="color: #fff">structures</span> <br><span title="macro definition" style="color: #00FFFF">;</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">typically</span> <span title="comment" style="color: #fff">just</span> <span title="comment" style="color: #fff">emit</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">single</span> <span title="comment" style="color: #fff">opcode</span> <span title="comment" style="color: #fff">for</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">machine</span> <span title="comment" style="color: #fff">return,</span> <span title="comment" style="color: #fff">example:</span> <br><span title="comment" style="color: #fff">==></span> <span title="machine code" style="color: #aaaaaa">c3</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">if</span> <span title="comment" style="color: #fff">(--</span> <span title="comment" style="color: #fff">ref)</span> <span title="comment" style="color: #fff">always</span> <span title="comment" style="color: #fff">matched</span> <span title="comment" style="color: #fff">with</span> <span title="macro execution" style="color: #FFFF00">then</span> <span title="comment" style="color: #fff">.</span> <span title="comment" style="color: #fff">The</span> <span title="comment" style="color: #fff">implementation</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">emit</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">branch</span> <span title="comment" style="color: #fff">instruction</span> <span title="comment" style="color: #fff">with</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">placeholder</span> <span title="comment" style="color: #fff">address.</span> <span title="comment" style="color: #fff">On</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack,</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">reference</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">pushed</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">this</span> <span title="comment" style="color: #fff">placeholder</span> <span title="comment" style="color: #fff">value</span> <span title="comment" style="color: #fff">in</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">code</span> <span title="comment" style="color: #fff">section.</span> <span title="comment" style="color: #fff">The</span> <span title="macro execution" style="color: #FFFF00">then</span> <span title="comment" style="color: #fff">definition</span> <span title="comment" style="color: #fff">can</span> <span title="comment" style="color: #fff">then</span> <span title="comment" style="color: #fff">touchup</span> <span title="comment" style="color: #fff">this</span> <span title="comment" style="color: #fff">offset</span> <span title="comment" style="color: #fff">when</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">branch</span> <span title="comment" style="color: #fff">destination</span> <span title="comment" style="color: #fff">is</span> <span title="comment" style="color: #fff">known.</span> <span title="comment" style="color: #fff">An</span> <span title="comment" style="color: #fff">example:</span> <br><span title="comment" style="color: #fff">==></span> <span title="compiled call, word, literal" style="color: #00FF7F">test</span> <span title="comment" style="color: #fff">opcode</span> <span title="comment" style="color: #fff">&</span> <span title="comment" style="color: #fff">placeholder</span> <span title="machine code" style="color: #aaaaaa">74</span> <span title="machine code" style="color: #aaaaaa">00</span> <span title="comment" style="color: #fff">push</span> <span title="comment" style="color: #fff">touchup</span> <span title="comment" style="color: #fff">location</span> <span title="macro execution" style="color: #FFFF00">ip@</span> <span title="macro execution" style="color: #FFFF00">01</span> <span title="macro execution" style="color: #FFFF00">-</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">then</span> <span title="comment" style="color: #fff">(ref</span> <span title="comment" style="color: #fff">--)</span> <span title="comment" style="color: #fff">matching</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">previous</span> <span title="macro execution" style="color: #FFFF00">if</span> <span title="comment" style="color: #fff">reference.</span> <span title="comment" style="color: #fff">TOS</span> <span title="comment" style="color: #fff">will</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">reference</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">byte/word</span> <span title="comment" style="color: #fff">in</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">code</span> <span title="comment" style="color: #fff">section</span> <span title="comment" style="color: #fff">where</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">offset</span> <span title="comment" style="color: #fff">needs</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">updated.</span> <span title="comment" style="color: #fff">An</span> <span title="comment" style="color: #fff">example</span> <span title="comment" style="color: #fff">implementation:</span> <br><span title="comment" style="color: #fff">==></span> <span title="comment" style="color: #fff">dup</span> <span title="comment" style="color: #fff">calculate</span> <span title="comment" style="color: #fff">relative</span> <span title="comment" style="color: #fff">offset</span> <span title="macro execution" style="color: #FFFF00">dup</span> <span title="macro execution" style="color: #FFFF00">01</span> <span title="macro execution" style="color: #FFFF00">+</span> <span title="macro execution" style="color: #FFFF00">ip@</span> <span title="macro execution" style="color: #FFFF00">swap</span> <span title="macro execution" style="color: #FFFF00">-</span> <span title="macro execution" style="color: #FFFF00">swap</span> <span title="comment" style="color: #fff">write</span> <span title="macro execution" style="color: #FFFF00">i!</span> <span title="macro execution" style="color: #FFFF00">;</span> <br><br><span title="macro definition" style="color: #00FFFF">for</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">ref)</span> <span title="comment" style="color: #fff">machine-specific</span> <span title="comment" style="color: #fff">code</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">implement</span> <span title="comment" style="color: #fff">looping.</span> <span title="comment" style="color: #fff">TOS</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">machine</span> <span title="comment" style="color: #fff">stack</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">consumed</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">this</span> <span title="comment" style="color: #fff">corresponds</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">number</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">iterations.</span> <span title="comment" style="color: #fff">Similar</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">if,</span> <span title="comment" style="color: #fff">should</span> <span title="comment" style="color: #fff">push</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">reference</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">current</span> <span title="comment" style="color: #fff">location</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack,</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">matched</span> <span title="comment" style="color: #fff">and</span> <span title="comment" style="color: #fff">consumed</span> <span title="comment" style="color: #fff">with</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">later</span> <span title="macro execution" style="color: #FFFF00">next</span> <span title="comment" style="color: #fff">.</span> <span title="comment" style="color: #fff">Must</span> <span title="comment" style="color: #fff">support</span> <span title="comment" style="color: #fff">nesting</span> <span title="comment" style="color: #fff">fors,</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">machine</span> <span title="word definition" style="color: #ff0000">return</span> <span title="comment" style="color: #fff">stack</span> <span title="comment" style="color: #fff">could</span> <span title="comment" style="color: #fff">be</span> <span title="comment" style="color: #fff">used</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">achieve</span> <span title="comment" style="color: #fff">this.</span> <br><br><span title="macro definition" style="color: #00FFFF">next</span> <span title="comment" style="color: #fff">(</span> <span title="comment" style="color: #fff">ref</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">end</span> <span title="comment" style="color: #fff">of</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">last</span> <span title="comment" style="color: #fff">loop.</span> <span title="comment" style="color: #fff">Loop</span> <span title="comment" style="color: #fff">back</span> <span title="comment" style="color: #fff">to</span> <span title="comment" style="color: #fff">ref</span> <span title="comment" style="color: #fff">as</span> <span title="comment" style="color: #fff">placed</span> <span title="comment" style="color: #fff">by</span> <span title="comment" style="color: #fff">previous</span> <span title="macro execution" style="color: #FFFF00">for</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="word definition" style="color: #ff0000">compiler</span> <span title="comment" style="color: #fff">stack.</span> <br><br><span title="comment" style="color: #fff">Stack</span> <span title="comment" style="color: #fff">operations</span> <br><span title="macro definition" style="color: #00FFFF">+</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">a+b)</span> <span title="comment" style="color: #fff">add</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">top</span> <span title="comment" style="color: #fff">two</span> <span title="comment" style="color: #fff">elements</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">stack</span> <br><span title="macro definition" style="color: #00FFFF">-</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">a-b)</span> <span title="comment" style="color: #fff">subtract</span> <span title="comment" style="color: #fff">TOS</span> <span title="comment" style="color: #fff">from</span> <span title="comment" style="color: #fff">previously</span> <span title="comment" style="color: #fff">pushed</span> <span title="comment" style="color: #fff">value</span> <br><span title="macro definition" style="color: #00FFFF">swap</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">b</span> <span title="comment" style="color: #fff">a)</span> <span title="comment" style="color: #fff">swap</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">top</span> <span title="comment" style="color: #fff">two</span> <span title="comment" style="color: #fff">items</span> <span title="comment" style="color: #fff">on</span> <span title="comment" style="color: #fff">the</span> <span title="comment" style="color: #fff">compiler</span> <span title="comment" style="color: #fff">stack</span> <br><span title="macro definition" style="color: #00FFFF">dup</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">a</span> <span title="comment" style="color: #fff">a)</span> <span title="comment" style="color: #fff">duplicate</span> <span title="comment" style="color: #fff">TOS</span> <br><span title="macro definition" style="color: #00FFFF">drop</span> <span title="comment" style="color: #fff">(a</span> <span title="comment" style="color: #fff">--</span> <span title="comment" style="color: #fff">)</span> <span title="comment" style="color: #fff">drop</span> <span title="comment" style="color: #fff">TOS</span> <br><br><br><br><br><br></body></html>